{% macro dirlisting(path='') -%}
    <ul>
    {% for subdirname in music_library.get_subdirs(path) %}
        {%- set subdirpath = path + subdirname + '/' %}
        <li>{{ subdirname }}/ <form method="post"><input type="text" value="{{ subdirpath }}" name="add_folder" hidden><input type="submit" value="Add all tracks from this folder"></form>
            <form method="post"><input type="text" value="{{ subdirpath }}" name="add_folder_recursively" hidden><input type="submit" value="Add all tracks from this folder (recursively)"></form></li>
        {%- set subdirs = music_library.get_subdirs(subdirpath) %}
        {%- if subdirs %}
            {%- for subdir in subdirs %}
                {{- dirlisting(subdirpath) -}}
            {%- endfor %}
        {%- endif %}
        <ul>
            {%- set files = music_library.get_files(subdirpath) %}
            {%- if files %}
                {% for file in files %}
                <!--<li>{{ file }}</li>-->
                <li><form method="post"><input type="text" value="{{ subdirpath }}/{{ file }}" name="add_file" hidden><input type="submit" value="Add">&nbsp;&nbsp;{{ file }}</form></li>
                {% endfor %}
            {%- endif %}
        </ul>
    {% endfor %}
    </ul>
{%- endmacro %}

<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <title></title>
    <link rel="stylesheet" href="{{ url_for('static', filename='index.css') }}">
    <META HTTP-EQUIV="Pragma" CONTENT="no-cache">
    <META HTTP-EQUIV="Expires" CONTENT="-1">
</head>
<body>
<a href="."><h5>Refresh</h5></a>
<br>
{% if False %}
<div id="download">
    <form action="./download" method="post" enctype="multipart/form-data">
        <input type="file" name="music_file" value="Browse Music file"/>
        <select name="directory">
            {% for dir in all_files %}
            <option value={{ dir }}>{{ dir }}</option>
            {% endfor %}
        </select>
        <input type="submit" value="Upload"/>
    </form>
</div>
{% endif %}
<div id="playlist">
    Current Playing :
    {% if current_music %}
    {{ current_music }}
    {% else %}
    No music
    {% endif %}
    <br>
    Playlist :
    <form method="post"><input type="text" value="randomize" name="action" hidden><input type="submit" value="Randomize playlist"></form>

    <ul>
        {% for m in playlist %}
        <li>{{ m }}
            <form method="post"><input type="text" value="{{ m }}" name="delete_music" hidden><input type="submit" value="X"></form>
        </li>
        {% endfor %}
    </ul>
    <h2>Music library:</h2>
    {{ dirlisting() }}


</div>
<div id="browser">

</div>
<div id="upload">

</div>
</body>
</html>
